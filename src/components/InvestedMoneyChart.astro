---
import financesData from '../data/finances.yaml';

interface FinancesData {
  currentInvestedMoney: number;
  currency: string;
  goal: number;
  history: { month: string; amount: number }[];
}

const finances = financesData as FinancesData;

const progress = Math.min((finances.currentInvestedMoney / finances.goal) * 100, 100);

const formattedCurrent = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: finances.currency,
  minimumFractionDigits: 0,
  maximumFractionDigits: 0,
}).format(finances.currentInvestedMoney);

const formattedGoal = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: finances.currency,
  minimumFractionDigits: 0,
  maximumFractionDigits: 0,
}).format(finances.goal);

// Calculate recent change
const previousAmount = finances.history[1]?.amount || finances.currentInvestedMoney;
const change = finances.currentInvestedMoney - previousAmount;
const changePercent = ((change / previousAmount) * 100).toFixed(1);
const isPositive = change >= 0;
---

<div class="rounded-xl border border-[var(--color-border)] bg-[var(--color-card)] p-5">
  <div class="flex items-center justify-between">
    <h3 class="text-sm font-medium text-[var(--color-text-muted)] uppercase tracking-wider">Invested Money</h3>
    <span class:list={[
      "inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-mono",
      isPositive ? "bg-green-500/10 text-[var(--color-success)]" : "bg-red-500/10 text-red-500"
    ]}>
      {isPositive ? '↑' : '↓'} {Math.abs(Number(changePercent))}%
    </span>
  </div>
  
  <p class="mt-2 font-serif text-3xl tracking-tight text-[var(--color-text)]">
    {formattedCurrent}
  </p>
  
  <div class="mt-4">
    <div class="flex items-center justify-between text-xs text-[var(--color-text-muted)]">
      <span>Progress to goal</span>
      <span>{progress.toFixed(1)}%</span>
    </div>
    <div class="mt-1.5 h-2 overflow-hidden rounded-full bg-[var(--color-bg-secondary)]">
      <div 
        class="h-full rounded-full bg-gradient-to-r from-[var(--color-accent)] to-[var(--color-success)] animate-grow-width"
        style={`width: ${progress}%`}
      />
    </div>
    <div class="mt-1.5 flex items-center justify-between text-xs text-[var(--color-text-muted)]">
      <span>$0</span>
      <span>Goal: {formattedGoal}</span>
    </div>
  </div>
</div>

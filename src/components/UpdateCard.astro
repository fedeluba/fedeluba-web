---
interface Props {
  title: string;
  date: Date;
  investedMoney: number; // Change amount (can be + or -)
  defiIncome: number; // DeFi income (always positive)
  highlights: string[];
  slug: string;
  index?: number;
}

const { title, date, investedMoney, defiIncome, highlights, slug, index = 0 } = Astro.props;

const formattedDate = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
});

const formatRelative = (amount: number, forcePositive = false) => {
  const prefix = amount >= 0 || forcePositive ? '+' : '-';
  return prefix + new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(Math.abs(amount));
};

const isPositiveInvestment = investedMoney >= 0;
---

<a 
  href={`/updates/${slug}`}
  class="group block rounded-xl border border-[var(--color-border)] bg-[var(--color-card)] p-5 no-underline transition-base hover:border-[var(--color-text-muted)] hover:shadow-lg hover:shadow-black/5 animate-fade-in-up"
  style={`animation-delay: ${index * 100}ms`}
>
  <div class="flex items-start justify-between gap-4">
    <div>
      <time class="text-xs font-mono text-[var(--color-text-muted)] uppercase tracking-wider">
        {formattedDate}
      </time>
      <h3 class="mt-1 font-serif text-xl font-normal text-[var(--color-text)] group-hover:text-[var(--color-accent)] transition-base">
        {title}
        <svg 
          class="ml-1 inline-block size-3.5 opacity-0 -translate-x-1 transition-base group-hover:opacity-100 group-hover:translate-x-0" 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path d="M9 5l7 7-7 7" />
        </svg>
      </h3>
    </div>
    <div class="text-right space-y-3">
      <div>
        <span class="block text-xs text-[var(--color-text-muted)]">Invested</span>
        <p class:list={[
          "font-mono text-sm font-medium",
          isPositiveInvestment ? "text-[var(--color-success)]" : "text-red-500"
        ]}>
          {formatRelative(investedMoney)}
        </p>
      </div>
      <div>
        <span class="block text-xs text-[var(--color-text-muted)]">DeFi Income</span>
        <p class="font-mono text-sm font-medium text-[var(--color-success)]">
          {formatRelative(defiIncome, true)}
        </p>
      </div>
    </div>
  </div>
  
  {highlights.length > 0 && (
    <ul class="mt-3 space-y-1">
      {highlights.slice(0, 3).map((highlight) => (
        <li class="flex items-start gap-2 text-sm text-[var(--color-text-secondary)]">
          <span class="mt-1.5 size-1 shrink-0 rounded-full bg-[var(--color-text)]" />
          {highlight}
        </li>
      ))}
    </ul>
  )}
</a>
